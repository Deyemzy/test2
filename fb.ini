###############################
#        SERVICE              #
###############################
[SERVICE]
  Flush        5               # Interval in seconds to flush logs to the destination
  Log_Level    info            # Logging verbosity: error, warning, info, debug, trace
  Daemon       Off             # Keep Fluent Bit running in the foreground for debugging
  Parsers_File parsers.conf    # Load custom parsers if needed
  Plugins_File plugins.conf    # Load external plugins (if required)

# Enable HTTP Server for metrics (Optional)
http_server  Off
http_listen  0.0.0.0
http_port    2020

# Enable Storage Metrics (Optional)
storage.metrics on

###############################
#        INPUTS               #
###############################
[INPUT]
  Name              tail
  Path              /var/log/jscape-mft-server.log  # Change this to the actual JSCAPE log file path
  Multiline         On                              # Enable multiline log handling
  Parser_Firstline  jscape_log_regex               # Define a regex parser if logs are multiline
  Tag               jscape_logs                    # Unique tag for filtering
  Skip_Long_Lines   On                             
  Refresh_Interval  10                              # Check for new logs every 10 seconds
  DB                /etc/fluent-bit/db/jscape-logs.db  # Maintain log position to avoid duplicate processing

###############################
#        FILTERS              #
###############################

# Apply a Lua script to add a timestamp or modify log fields if needed
[FILTER]
  Name   lua
  Match  jscape_logs
  Script /etc/fluent-bit/scripts.lua   # Ensure this script exists
  Call   append_time_field

# Modify Records: Add custom fields to logs
[FILTER]
  Name   record_modifier
  Match  jscape_logs
  Record app        jscape
  Record source     ${HOSTNAME}
  Record log_type   security_event  # Customize based on JSCAPE log contents

###############################
#        OUTPUTS              #
###############################

# Send logs to Loki (Recommended for Grafana visualization)
[OUTPUT]
  Name        loki
  Match       *
  Host        loki-server-address  # Change to your Loki server address
  Port        3100
  Labels      job=jscape_logs,source=fluentbit

# Alternative: Send logs to Elasticsearch
# [OUTPUT]
#   Name  es
#   Match *
#   Host  elasticsearch-server
#   Port  9200
#   Index jscape-logs

# Alternative: Send logs to Prometheus
# [OUTPUT]
#   Name  prometheus_remote_write
#   Match *
#   Host  prometheus-server
#   Port  9090
