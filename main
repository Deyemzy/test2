// Get the file name and file extension
set fileName "${Name}"
set fileDir "${FileParentDirectory}"
set filePath "${File}"

// Find the position of the last period (for the extension)
prompt lastDotPos "${fileName.lastIndexOf('.')}"

// Check if there is an extension
if ${lastDotPos} > 0
  // Split the filename into base and extension
  prompt baseName "${fileName.substring(0, lastDotPos)}"
  prompt extension "${fileName.substring(lastDotPos)}"
  
  // Create the new filename with "_processed" appended
  set newFileName "${baseName}_processed${extension}"
else
  // No extension, just append "_processed"
  set newFileName "${fileName}_processed"
endif

// Rename the file using the lrename command
lrename "${filePath}" "${fileDir}/${newFileName}"

// Log the action
msg "Renamed file ${fileName} to ${newFileName}"
